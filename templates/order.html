{% extends 'base.html' %}

{% block head %}

{% endblock %}

{% block body %}
<div class="content">
    <div class="head-content">
        <p>Order Bahan</p>
    </div>
    <div class="main-content">
        <form action="/order" method="POST" id="orderForm"
      onsubmit="return handleOrderSubmit(event);">
            <label for="dropdownBahan">Pilih Bahan:</label>
            <select id="dropdownBahan" name="dropdownBahan" onchange="updateHarga()">
                <option value="">--Pilih Bahan--</option>
                {% for bahan in bahans %}
                <option value="{{bahan.id}}" data-harga="{{bahan.hargaPerSatuan}}">
                    {{bahan.namaBahan}} ({{bahan.satuan}}) - Rp{{"{:,}".format(bahan.hargaPerSatuan)}}
                </option>
                {% endfor %}
            </select>

            <br>
            <label for="jmlhBahan">Jumlah:</label>
            <input type="number" id="jmlhBahan" name="jmlhBahan" value="1" min="1" onchange="updateTotal()">

            <br>
            <p>Harga per satuan: <span id="hargaSatuan">-</span></p>
            <p><b>Total Harga:</b> <span id="totalHarga">-</span></p>

            <br>
            <input type="submit" value="Order">
        </form>
    </div>
</div>
<script>
function updateHarga() {
    const select = document.getElementById("dropdownBahan");
    const harga = select.options[select.selectedIndex].getAttribute("data-harga");
    document.getElementById("hargaSatuan").innerText = harga ? "Rp " + parseInt(harga).toLocaleString() : "-";
    updateTotal();
}

function updateTotal() {
    const select = document.getElementById("dropdownBahan");
    const harga = parseInt(select.options[select.selectedIndex].getAttribute("data-harga") || 0);
    const jumlah = parseInt(document.getElementById("jmlhBahan").value || 0);
    const total = harga * jumlah;
    document.getElementById("totalHarga").innerText = total ? "Rp " + total.toLocaleString() : "-";
}
</script>
<script>
function handleOrderSubmit(e) {
    // Ambil elemen
    const select = document.getElementById("dropdownBahan");
    const jumlahInput = document.getElementById("jmlhBahan");
    
    // Ambil data dari opsi yang dipilih
    const selectedOption = select.options[select.selectedIndex];
    const namaBahan = selectedOption.text || "-";
    const hargaPerSatuan = parseInt(selectedOption.getAttribute("data-harga") || 0);
    const jumlah = parseInt(jumlahInput.value || 0);
    const total = hargaPerSatuan * jumlah;

    // Jika belum pilih bahan
    if (!selectedOption.value) {
        alert("⚠️ Silakan pilih bahan terlebih dahulu.");
        return false;
    }

    // Konfirmasi awal
    const konfirmasi = confirm(
        `Yakin melakukan order ini?\n\n` +
        `Bahan : ${namaBahan}\n` +
        `Jumlah : ${jumlah}\n` +
        `Total Harga : Rp${total.toLocaleString('id-ID')}`
    );

    // Jika tekan Cancel, hentikan
    if (!konfirmasi) {
        alert("❌ Order dibatalkan.");
        return false;
    }

    // Kalau OK, tampilkan popup hasil order
    alert(
        `✅ Order Berhasil!\n\n` +
        `Bahan: ${namaBahan}\n` +
        `Jumlah: ${jumlah}\n` +
        `Total Harga: Rp${total.toLocaleString('id-ID')}`
    );

    return true; // lanjutkan submit ke Flask backend
}
</script>


{% endblock %}